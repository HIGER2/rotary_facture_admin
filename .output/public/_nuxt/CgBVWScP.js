import{G as E,H as o,r as f,z as g,a8 as h,I as i,n as I}from"./5byMhkSk.js";const x=E("facture",()=>{async function c(n){return await o(`/facture/all?${n.toString()}`)}async function m(n){return await o("/facture/createFromFile",{method:"POST",body:n})}async function d(n,v="send"){return await o(`/facture/create?send=${v}`,{method:"POST",body:n})}async function y(n){return await o("/facture/sendFacture",{method:"POST",body:n})}async function u(n){return await o("/facture/update",{method:"PUT",body:n})}async function l(n){return await o(`/facture/find/${n}`)}async function p(n){return await o(`/facture/get/${n}`)}return{all:c,create:d,findWithPaiement:l,find:p,update:u,sendFacture:y,createFactureFromFile:m}}),H=E("FactureViewModel",()=>{const c=x(),m=f([]),d=f([]),y=f({}),u=f(!1),l=f(null),p=new Date().toISOString().split("T")[0],n=[{label:"facture.colunm.td1",key:"reference"},{label:"facture.colunm.td2",key:"amount"},{label:"facture.colunm.td3",key:"amount_pay"},{label:"facture.colunm.td4",key:"remaining_amount"},{label:"facture.colunm.td5",key:"status"},{label:"facture.colunm.td6",key:"status_payment"},{label:"facture.colunm.td7",key:"date_emission"},{label:"facture.colunm.td8",key:"date_echeance"},{label:"facture.colunm.td9",key:"action"}],v={admin:n,super_admin:n,club:[{label:"facture.colunm.td1",key:"reference"},{label:"facture.colunm.td2",key:"amount"},{label:"facture.colunm.td3",key:"amount_pay"},{label:"facture.colunm.td4",key:"remaining_amount"},{label:"facture.colunm.td5",key:"status"},{label:"facture.colunm.td6",key:"status_payment"},{label:"facture.colunm.td7",key:"date_emission"},{label:"facture.colunm.td8",key:"date_echeance"}]};let U={rubrique_id:null,price:"",quantity:"",designation:"",libele:""},F={club_id:"",objet:"",date_emission:p,date_echeance:""};const w=g({...F}),r=g([]),b=g({...F,id:null}),k=h(()=>r.length),q=h(()=>r.reduce((a,e)=>a+=Number(e.quantity),0)),C=h(()=>r.reduce((a,e)=>a+=Number(e.quantity)*Number(e.price),0));async function j(a){var t,s,O,P,T;const e=await c.all(a);return d.value=(t=e==null?void 0:e.data)==null?void 0:t.analytic,m.value=[...(O=(s=e.data)==null?void 0:s.data)==null?void 0:O.data],(T=(P=e==null?void 0:e.data)==null?void 0:P.data)==null?void 0:T.data}async function N(){var t;if(!l.value){alert("Merci de bien vouloir selectionner un fichier");return}const a=new FormData;a.append("file",l.value),u.value=!0;const e=await c.createFactureFromFile(a);e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&(_(),S(),i("Opération éffectuée",{autoClose:1e3,type:i.TYPE.SUCCESS})),u.value=!1}async function R(a="send"){var s;if(r.length==0){alert("Merci de bien vouloir saisir au moins une rubrique");return}if(!confirm("Voulez-vous éffectuer cette action ?"))return;u.value=a;let e={facture:{...w,total_rubrique:k.value,amount:C.value,total_quantity:q.value},rubrique:[...r]};const t=await c.create(e,a);t!=null&&t.error&&alert((s=t==null?void 0:t.error)==null?void 0:s.message),t!=null&&t.data&&(_(),S(),i("Opération éffectuée",{autoClose:1e3,type:i.TYPE.SUCCESS})),u.value=!1}async function V(){var t;u.value=!0;let a={...b};const e=await c.update(a);e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&i("Opération éffectuée",{autoClose:1e3,type:i.TYPE.SUCCESS}),u.value=!1}async function z(a){var t;const e=await c.findWithPaiement(a);y.value=(t=e==null?void 0:e.data)==null?void 0:t.data}async function M(a){var t;if(!confirm("Voulez-vous vraiment envoyer la facture ?"))return;u.value=!0;const e=await c.sendFacture({reference:a});e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&i("Opération éffectuée",{autoClose:1e3,type:i.TYPE.SUCCESS}),u.value=!1}async function Y(a){var t;const e=await c.find(a);Object.assign(b,(t=e==null?void 0:e.data)==null?void 0:t.data)}const $=(a=0)=>{r.push({...U,quantity:a||""})},D=a=>{r.splice(a,1)};function _(){Object.assign(w,{...F})}function S(){r.splice(0,r.length)}function W(){Object.assign(b,{club_id:"",objet:"",id:null})}return{all:j,factures:m,facture:y,create:R,findWithPaiement:z,newFacture:w,newRubrique:r,isLoading:u,find:Y,updateFacture:b,update:V,cancel:()=>{confirm("Voulez-vous vraiment annuler cette action ?")&&(_(),S(),W(),I("/account/factures"))},analityc:d,addRubrique:$,removeRubrique:D,total_rubrique:k,total_quantity:q,total_amount:C,sendFacture:M,columns:v,file:l,createFactureFromFile:N}});export{H as u};
