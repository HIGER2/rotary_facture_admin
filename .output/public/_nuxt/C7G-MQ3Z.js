import{E as T,G as i,r as y,y as w,a7 as g,H as o,n as Y}from"./DoEeMXyA.js";const x=T("facture",()=>{async function c(n){return await i(`/facture/all?${n.toString()}`)}async function s(n,p="send"){return await i(`/facture/create?send=${p}`,{method:"POST",body:n})}async function f(n){return await i("/facture/sendFacture",{method:"POST",body:n})}async function d(n){return await i("/facture/update",{method:"PUT",body:n})}async function r(n){return await i(`/facture/find/${n}`)}async function b(n){return await i(`/facture/get/${n}`)}return{all:c,create:s,findWithPaiement:r,find:b,update:d,sendFacture:f}}),G=T("FactureViewModel",()=>{const c=x(),s=y([]),f=y([]),d=y({}),r=y(!1),b=new Date().toISOString().split("T")[0],n=[{label:"facture.colunm.td1",key:"reference"},{label:"facture.colunm.td2",key:"amount"},{label:"facture.colunm.td3",key:"amount_pay"},{label:"facture.colunm.td4",key:"remaining_amount"},{label:"facture.colunm.td5",key:"status"},{label:"facture.colunm.td6",key:"status_payment"},{label:"facture.colunm.td7",key:"date_emission"},{label:"facture.colunm.td8",key:"date_echeance"},{label:"facture.colunm.td9",key:"action"}],p={admin:n,super_admin:n,club:[{label:"facture.colunm.td1",key:"reference"},{label:"facture.colunm.td2",key:"amount"},{label:"facture.colunm.td3",key:"amount_pay"},{label:"facture.colunm.td4",key:"remaining_amount"},{label:"facture.colunm.td5",key:"status"},{label:"facture.colunm.td6",key:"status_payment"},{label:"facture.colunm.td7",key:"date_emission"},{label:"facture.colunm.td8",key:"date_echeance"}]};let E={rubrique_id:null,price:"",quantity:"",designation:"",libele:""},v={club_id:"",objet:"",date_emission:b,date_echeance:""};const _=w({...v}),u=w([]),m=w({...v,id:null}),k=g(()=>u.length),S=g(()=>u.reduce((a,e)=>a+=Number(e.quantity),0)),h=g(()=>u.reduce((a,e)=>a+=Number(e.quantity)*Number(e.price),0));async function j(a){var t,l,C,O,P;const e=await c.all(a);return f.value=(t=e==null?void 0:e.data)==null?void 0:t.analytic,s.value=[...(C=(l=e.data)==null?void 0:l.data)==null?void 0:C.data],(P=(O=e==null?void 0:e.data)==null?void 0:O.data)==null?void 0:P.data}async function N(a="send"){var l;if(u.length==0){alert("Merci de bien vouloir saisir au moins une rubrique");return}if(!confirm("Voulez-vous éffectuer cette action ?"))return;r.value=a;let e={facture:{..._,total_rubrique:k.value,amount:h.value,total_quantity:S.value},rubrique:[...u]};const t=await c.create(e,a);t!=null&&t.error&&alert((l=t==null?void 0:t.error)==null?void 0:l.message),t!=null&&t.data&&(q(),F(),o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS})),r.value=!1}async function R(){var t;r.value=!0;let a={...m};const e=await c.update(a);e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS}),r.value=!1}async function U(a){var t;const e=await c.findWithPaiement(a);d.value=(t=e==null?void 0:e.data)==null?void 0:t.data}async function V(a){var t;if(!confirm("Voulez-vous vraiment envoyer la facture ?"))return;r.value=!0;const e=await c.sendFacture({reference:a});e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS}),r.value=!1}async function $(a){var t;const e=await c.find(a);Object.assign(m,(t=e==null?void 0:e.data)==null?void 0:t.data)}const z=(a=0)=>{u.push({...E,quantity:a||""})},M=a=>{u.splice(a,1)};function q(){Object.assign(_,{...v})}function F(){u.splice(0,u.length)}function W(){Object.assign(m,{club_id:"",objet:"",id:null})}return{all:j,factures:s,facture:d,create:N,findWithPaiement:U,newFacture:_,newRubrique:u,isLoading:r,find:$,updateFacture:m,update:R,cancel:()=>{confirm("Voulez-vous vraiment annuler cette action ?")&&(q(),F(),W(),Y("/account/factures"))},analityc:f,addRubrique:z,removeRubrique:M,total_rubrique:k,total_quantity:S,total_amount:h,sendFacture:V,columns:p}});export{G as u};
