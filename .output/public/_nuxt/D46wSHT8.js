import{G as F,r as y,z as w,J as k,N as o}from"./7f7kRU4D.js";import{u as l}from"./DjuaHcYr.js";const M=F("facture",()=>{async function c(u){return await l(`/facture/all?${u.toString()}`)}async function s(u,b="send"){return await l(`/facture/create?send=${b}`,{method:"POST",body:u})}async function f(u){return await l("/facture/sendFacture",{method:"POST",body:u})}async function m(u){return await l("/facture/update",{method:"PUT",body:u})}async function r(u){return await l(`/facture/find/${u}`)}async function d(u){return await l(`/facture/get/${u}`)}return{all:c,create:s,findWithPaiement:r,find:d,update:m,sendFacture:f}}),Y=F("FactureViewModel",()=>{const c=M(),s=y([]),f=y([]),m=y({}),r=y(!1),d=[{label:"facture.colunm.td1",key:"reference"},{label:"facture.colunm.td2",key:"amount"},{label:"facture.colunm.td3",key:"amount_pay"},{label:"facture.colunm.td4",key:"remaining_amount"},{label:"facture.colunm.td5",key:"type"},{label:"facture.colunm.td6",key:"status"},{label:"facture.colunm.td7",key:"date_emission"},{label:"facture.colunm.td8",key:"date_echeance"},{label:"facture.colunm.td9",key:"action"}],u={admin:d,super_admin:d,club:[{label:"facture.colunm.td1",key:"reference"},{label:"facture.colunm.td2",key:"amount"},{label:"facture.colunm.td3",key:"amount_pay"},{label:"facture.colunm.td3",key:"remaining_amount"},{label:"facture.colunm.td5",key:"type"},{label:"facture.colunm.td6",key:"status"},{label:"facture.colunm.td7",key:"date_emission"},{label:"facture.colunm.td8",key:"date_echeance"}]};let b={libele:"",amount:"",quantity:"",comment:""},_={club_id:"",objet:""};const p=w({..._}),n=w([]),v=w({..._,id:null}),h=k(()=>n.length),q=k(()=>n.reduce((a,e)=>a+=Number(e.quantity),0)),S=k(()=>n.reduce((a,e)=>a+=Number(e.quantity)*Number(e.amount),0));async function C(a){var t,i,g;const e=await c.all(a);f.value=(t=e==null?void 0:e.data)==null?void 0:t.analytic,s.value=[...(g=(i=e.data)==null?void 0:i.data)==null?void 0:g.data]}async function P(a="send"){var i;if(n.length==0){alert("Merci de bien vouloir saisir au moins une rubrique");return}r.value=a;let e={facture:{...p,total_rubrique:h.value,amount:S.value,total_quantity:q.value},rubrique:[...n]};const t=await c.create(e,a);t!=null&&t.error&&alert((i=t==null?void 0:t.error)==null?void 0:i.message),U(),$(),t!=null&&t.data&&o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS}),r.value=!1}async function O(){var t;r.value=!0;let a={...v};const e=await c.update(a);e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS}),r.value=!1}async function E(a){var t;const e=await c.findWithPaiement(a);m.value=(t=e==null?void 0:e.data)==null?void 0:t.data}async function N(a){var t;if(!confirm("Voulez-vous vraiment envoyer la facture ?"))return;r.value=!0;const e=await c.sendFacture({reference:a});e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS}),r.value=!1}async function T(a){var t;const e=await c.find(a);Object.assign(v,(t=e==null?void 0:e.data)==null?void 0:t.data)}const R=(a=0)=>{n.push({...b,quantity:a||""})},j=a=>{n.splice(a,1)};function U(){Object.assign(p,{club_id:"",objet:""})}function $(){n.splice(0,n.length)}return{all:C,factures:s,facture:m,create:P,findWithPaiement:E,newFacture:p,newRubrique:n,isLoading:r,find:T,updateFacture:v,update:O,analityc:f,addRubrique:R,removeRubrique:j,total_rubrique:h,total_quantity:q,total_amount:S,sendFacture:N,columns:u}});export{Y as u};
