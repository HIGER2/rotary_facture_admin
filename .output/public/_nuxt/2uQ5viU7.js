import{B as C,r as y,z as p,N as w,G as c}from"./B6_zqcbV.js";import{u as o}from"./B6Xcuug8.js";const _=C("facture",()=>{async function n(u){return await o(`/facture/all?${u.toString()}`)}async function l(u,m="send"){return await o(`/facture/create?send=${m}`,{method:"POST",body:u})}async function f(u){return await o("/facture/sendFacture",{method:"POST",body:u})}async function d(u){return await o("/facture/update",{method:"PUT",body:u})}async function r(u){return await o(`/facture/find/${u}`)}async function b(u){return await o(`/facture/get/${u}`)}return{all:n,create:l,findWithPaiement:r,find:b,update:d,sendFacture:f}}),V=C("FactureViewModel",()=>{const n=_(),l=y([]),f=y([]),d=y({}),r=y(!1);let b={libele:"",amount:"",quantity:"",comment:""},u={club_id:"",objet:""};const m=p({...u}),i=p([]),v=p({...u,id:null}),q=w(()=>i.length),S=w(()=>i.reduce((a,e)=>a+=Number(e.quantity),0)),F=w(()=>i.reduce((a,e)=>a+=Number(e.quantity)*Number(e.amount),0));async function g(a){var t,s,h;const e=await n.all(a);f.value=(t=e==null?void 0:e.data)==null?void 0:t.analytic,l.value=[...(h=(s=e.data)==null?void 0:s.data)==null?void 0:h.data]}async function P(a="send"){var s;if(i.length==0){alert("Merci de bien vouloir saisir au moins une rubrique");return}r.value=a;let e={facture:{...m,total_rubrique:q.value,amount:F.value,total_quantity:S.value},rubrique:[...i]};const t=await n.create(e,a);t!=null&&t.error&&alert((s=t==null?void 0:t.error)==null?void 0:s.message),t!=null&&t.data&&c("Opération éffectuée",{autoClose:1e3,type:c.TYPE.SUCCESS}),r.value=!1}async function E(){var t;r.value=!0;let a={...v};const e=await n.update(a);e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&c("Opération éffectuée",{autoClose:1e3,type:c.TYPE.SUCCESS}),r.value=!1}async function O(a){var t;const e=await n.findWithPaiement(a);d.value=(t=e==null?void 0:e.data)==null?void 0:t.data}async function R(a){var t;if(!confirm("Voulez-vous vraiment envoyer la facture ?"))return;r.value=!0;const e=await n.sendFacture({reference:a});e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&c("Opération éffectuée",{autoClose:1e3,type:c.TYPE.SUCCESS}),r.value=!1}async function T(a){var t;const e=await n.find(a);Object.assign(v,(t=e==null?void 0:e.data)==null?void 0:t.data)}return{all:g,factures:l,facture:d,create:P,findWithPaiement:O,newFacture:m,newRubrique:i,isLoading:r,find:T,updateFacture:v,update:E,analityc:f,addRubrique:()=>{i.push({...b})},removeRubrique:a=>{i.splice(a,1)},total_rubrique:q,total_quantity:S,total_amount:F,sendFacture:R}});export{V as u};
