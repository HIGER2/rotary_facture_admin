import{B as C,r as y,z as v,Q as k,I as o}from"./l5F4RGht.js";import{u as l}from"./B4uPnpJb.js";const U=C("facture",()=>{async function r(u){return await l(`/facture/all?${u.toString()}`)}async function s(u,b="send"){return await l(`/facture/create?send=${b}`,{method:"POST",body:u})}async function f(u){return await l("/facture/sendFacture",{method:"POST",body:u})}async function m(u){return await l("/facture/update",{method:"PUT",body:u})}async function n(u){return await l(`/facture/find/${u}`)}async function d(u){return await l(`/facture/get/${u}`)}return{all:r,create:s,findWithPaiement:n,find:d,update:m,sendFacture:f}}),W=C("FactureViewModel",()=>{const r=U(),s=y([]),f=y([]),m=y({}),n=y(!1),d=[{label:"facture.colunm.td1",key:"reference"},{label:"facture.colunm.td2",key:"amount"},{label:"facture.colunm.td3",key:"amount_pay"},{label:"facture.colunm.td4",key:"remaining_amount"},{label:"facture.colunm.td5",key:"type"},{label:"facture.colunm.td6",key:"status"},{label:"facture.colunm.td7",key:"date_emission"},{label:"facture.colunm.td8",key:"date_echeance"},{label:"facture.colunm.td9",key:"action"}],u={admin:d,super_admin:d,club:[{label:"facture.colunm.td1",key:"reference"},{label:"facture.colunm.td2",key:"amount"},{label:"facture.colunm.td3",key:"amount_pay"},{label:"facture.colunm.td3",key:"remaining_amount"},{label:"facture.colunm.td5",key:"type"},{label:"facture.colunm.td6",key:"status"},{label:"facture.colunm.td7",key:"date_emission"},{label:"facture.colunm.td8",key:"date_echeance"}]};let b={libele:"",amount:"",quantity:"",comment:""},w={club_id:"",objet:""};const q=v({...w}),c=v([]),p=v({...w,id:null}),_=k(()=>c.length),S=k(()=>c.reduce((a,e)=>a+=Number(e.quantity),0)),h=k(()=>c.reduce((a,e)=>a+=Number(e.quantity)*Number(e.amount),0));async function F(a){var t,i,g;const e=await r.all(a);f.value=(t=e==null?void 0:e.data)==null?void 0:t.analytic,s.value=[...(g=(i=e.data)==null?void 0:i.data)==null?void 0:g.data]}async function P(a="send"){var i;if(c.length==0){alert("Merci de bien vouloir saisir au moins une rubrique");return}n.value=a;let e={facture:{...q,total_rubrique:_.value,amount:h.value,total_quantity:S.value},rubrique:[...c]};const t=await r.create(e,a);t!=null&&t.error&&alert((i=t==null?void 0:t.error)==null?void 0:i.message),t!=null&&t.data&&o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS}),n.value=!1}async function E(){var t;n.value=!0;let a={...p};const e=await r.update(a);e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS}),n.value=!1}async function O(a){var t;const e=await r.findWithPaiement(a);m.value=(t=e==null?void 0:e.data)==null?void 0:t.data}async function R(a){var t;if(!confirm("Voulez-vous vraiment envoyer la facture ?"))return;n.value=!0;const e=await r.sendFacture({reference:a});e!=null&&e.error&&alert((t=e==null?void 0:e.error)==null?void 0:t.message),e!=null&&e.data&&o("Opération éffectuée",{autoClose:1e3,type:o.TYPE.SUCCESS}),n.value=!1}async function T(a){var t;const e=await r.find(a);Object.assign(p,(t=e==null?void 0:e.data)==null?void 0:t.data)}return{all:F,factures:s,facture:m,create:P,findWithPaiement:O,newFacture:q,newRubrique:c,isLoading:n,find:T,updateFacture:p,update:E,analityc:f,addRubrique:(a=0)=>{c.push({...b,quantity:a||""})},removeRubrique:a=>{c.splice(a,1)},total_rubrique:_,total_quantity:S,total_amount:h,sendFacture:R,columns:u}});export{W as u};
