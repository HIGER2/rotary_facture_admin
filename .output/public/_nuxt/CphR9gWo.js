import{G as C,r as f,z as T,a7 as W,n,j as E}from"./C8Ssyemp.js";import{u as g}from"./DXhcHfDF.js";const O=C("auth",()=>{async function o(a){return await g("/register",{method:"POST",body:a})}async function d(a){return await g("/auth/login",{method:"POST",body:a})}async function m(){return await g("/auth/logout")}async function r(a){return await g(`/auth/magic-login/${a}`)}async function y(){return await g("/auth/connected")}return{register:o,login:d,logout:m,loginWithToken:r,connected:y}}),V=C("AuthViewModel",()=>{const o=O(),{setCookie:d,removeCookie:m}=W();f();const r=f(!1),y=f(null),a=f(null),w=T({name:"",last_name:"",email:"",phone:"",password:""}),k=T({identifiant:"",type:"member",password:""}),h=(e=null)=>{a.value=e};async function I(){await o.register(w)}async function q(){var t,s,i,c,u,l,v;r.value=!0,h();const e=await o.login(k);if(r.value=!1,!e.error)if((t=e.data.data)!=null&&t.redirect)d("token",(i=(s=e.data)==null?void 0:s.data)==null?void 0:i.token),n("/account/home");else{let p=E(),S=localStorage.getItem("pay");(c=p.query)!=null&&c.pay&&!S&&localStorage.setItem("pay",(u=p.query)==null?void 0:u.pay),!((l=p.query)!=null&&l.pay)&&S&&localStorage.removeItem("pay"),n({path:"/auth/login",query:{success:"true"}},{replace:!0})}e.error&&h((v=e.error)==null?void 0:v.message)}async function b(){await o.logout(),m("token"),n("/auth/login")}async function A(e){var s,i,c,u;const t=await o.loginWithToken(e);if(console.log((s=t.error)==null?void 0:s.code),t.error)t.error&&((u=t.error)==null?void 0:u.code)===403&&n("/auth/login");else{d("token",(c=(i=t.data)==null?void 0:i.data)==null?void 0:c.token);let l=localStorage.getItem("pay");if(l){localStorage.removeItem("pay"),n(`/account/factures/${l}`);return}n("/account/home")}}async function M(){var t;let e=await o.connected();y.value=(t=e==null?void 0:e.data)==null?void 0:t.data}return{register:I,login:q,newUser:w,authUser:k,conntected:M,userConnected:y,logout:b,isLoading:r,loginWithToken:A,setMessageError:h,messageError:a}});export{V as u};
