import{B as p,r as g,z as k,a4 as A,n as c}from"./BLHCOQbN.js";import{u}from"./yaMsInDW.js";const M=p("auth",()=>{async function n(o){return await u("/register",{method:"POST",body:o})}async function l(o){return await u("/auth/login",{method:"POST",body:o})}async function h(){return await u("/auth/logout")}async function a(o){return await u(`/auth/magic-login/${o}`)}async function d(){return await u("/auth/connected")}return{register:n,login:l,logout:h,loginWithToken:a,connected:d}}),O=p("AuthViewModel",()=>{const n=M(),{setCookie:l,removeCookie:h}=A();g();const a=g(!1),d=g(null),o=g(null),m=k({name:"",last_name:"",email:"",phone:"",password:""}),w=k({identifiant:"admin@gmail.com",type:"member",password:"password"}),f=(e=null)=>{o.value=e};async function v(){await n.register(m)}async function T(){var t,r,s,i;a.value=!0,f();const e=await n.login(w);a.value=!1,e.error||((t=e.data.data)!=null&&t.redirect?(l("token",(s=(r=e.data)==null?void 0:r.data)==null?void 0:s.token),c("/account/home")):c({path:"/auth/login",query:{success:"true"}},{replace:!0})),e.error&&f((i=e.error)==null?void 0:i.message)}async function C(){await n.logout(),h("token"),c("/auth/login")}async function S(e){var r,s,i,y;const t=await n.loginWithToken(e);console.log((r=t.error)==null?void 0:r.code),t.error?t.error&&((y=t.error)==null?void 0:y.code)===403&&c("/auth/login"):(l("token",(i=(s=t.data)==null?void 0:s.data)==null?void 0:i.token),c("/account/home"))}async function b(){var t;let e=await n.connected();d.value=(t=e==null?void 0:e.data)==null?void 0:t.data}return{register:v,login:T,newUser:m,authUser:w,conntected:b,userConnected:d,logout:C,isLoading:a,loginWithToken:S,setMessageError:f,messageError:o}});export{O as u};
